<div class="flex flex-col items-startmx-auto px-4 py-6 md:h-72 md:p-4 space-y-2 justify-center border-b md:border md:shadow-sm md:rounded-xl md:hover:shadow-lg" data-controller="image-modal">
    <p class="font-bold flex items-center justify-start w-full font-zenmaru text-sm text-neutral"><span><i class="ph-fill ph-map-pin fa-lg inline-block"></i></span>&nbsp;<%= review.spot.name %></p>        
    <div class="flex w-full justify-between">
        <div class="flex items-center">
            <div>
                <% if review.user.avatar.present? %>
                    <%= image_tag review.user.avatar.url, class: "inline-block rounded-full h-9 w-9" %>
                <% else %>
                    <%= image_tag("default.webp", class: "inline-block rounded-full h-9 w-9") %>
                <% end %>
            </div>
            <div class="ml-3">
                <span class="block text-sm text-neutral"><%= review.user.name %></span>
                <span class="block text-xs text-secondary"><%= review.created_at.strftime('%Y/%m/%d') %></span>
            </div>
        </div>
        <div class="flex space-x-2 items-center">
            <% if review.user == current_user %>
                <%= render 'spots/crud_menus', review: review %>
            <% end %>
        </div>
    </div>

        <div class="-ml-2 flex gap-0.5 pl-2 py-2">  
        <% rating = review.rating %>
        <% full_stars = rating %>
        <% empty_stars = 5 - rating %>
        
        <% full_stars.times do %>
            <i class="ph-fill ph-star fa-lg text-yellow-400"></i>
        <% end %>
        
        <% empty_stars.times do %>
            <i class="ph-fill ph-star fa-lg text-gray-100"></i>
        <% end %>
    </div>
    
      <!-- stars - end -->
    <div class="review text-secondary text-xs">
        <% if review.body.present? && review.long_body? %>
            <%= review.body.first(30) %>...
            <%= link_to "もっと見る", '#' %>
        <% else %>
            <%= review.body %>
        <% end %>
    </div>

    <% if review.images.present? %>
      <div class="flex space-x-2">
        <% review.images.each do |image| %>
          <%= image_tag image.to_s, data: { action: "click->image-modal#open", image_url: image.url }, class: "inline-block rounded h-12 w-12" %>
        <% end %>
      </div>
    <% end %>


    <% unless review.user == current_user %>
        <div class="flex justify-center space-x-2 items-end">
            <button class="bg-primary text-secondary text-sm px-3 drop-shadow-md py-2 rounded-lg flex mx-auto items-center justify-center">
                <p><i class="ph ph-fill ph-hand-heart fa-lg"></i> 参考になった</p>
            </button>
        </div>
    <% end %>


<!-- モーダル -->
<div class="fixed inset-0 bg-gray-500 bg-opacity-50 hidden z-50" data-image-modal-target="imageModal">
    <div class="fixed inset-0 flex items-center justify-center z-100">
        <% if review.images.length == 1 %>
            <div class="rounded shadow-md relative">
                <img data-image-modal-target="image" class="max-w-96 max-h-96"/>
                <button data-action="click->image-modal#close" class="absolute top-3 right-4 m-4 text-secondary rounded-full bg-white shadow-md px-2 py-1 items-center">
                    <i class="ph-bold ph-x text-secondary"></i>
                </button>
            </div>
        <% else %>
            <div class="bg-white p-4 rounded shadow-md relative flex items-center">
                <button data-action="click->image-modal#prev" class="absolute left-0 top-1/2 transform -translate-y-1/2 p-2 text-primary text-3xl bg-opacity-50 rounded-full">
                <i class="ph-bold ph-caret-left fa-2xl"></i>
                </button>
                <div class="carousel transition duration-700 ease-in-out" data-image-modal-target="carousel">
                    <% review.images.each_with_index do |image, index| %>
                        <img src="<%= image.url %>" class="max-w-96 max-h-96 <%= index == 0 ? 'block' : 'hidden' %>" data-image-modal-target="carouselImage"/>
                    <% end %>
                </div>
                <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex space-x-2 mt-4" data-image-modal-target="indicators">
                    <% review.images.each_with_index do |image, index| %>
                        <div class="indicator w-3 h-3 rounded-full <%= index == 0 ? 'bg-secondary' : 'bg-primary' %>" data-image-modal-target="indicator" data-action="click->image-modal#indicatorClick" data-index="<%= index %>"></div>
                    <% end %>
                </div>
                <button data-action="click->image-modal#next" class="absolute right-0 top-1/2 transform -translate-y-1/2 p-2 text-primary text-3xl bg-opacity-50 rounded-full">
                    <i class="ph-bold ph-caret-right fa-2xl"></i>
                </button>
                <button data-action="click->image-modal#close" class="absolute top-4 right-6 m-4 text-secondary rounded-full bg-white shadow-md px-2 py-1 items-center">
                    <i class="ph-bold ph-x h-6 w-6 text-secondary"></i>
                </button>
            </div>
        <% end %>
    </div>
</div>
</div>
