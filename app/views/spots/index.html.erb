<div class="md:flex md:mt-16">
  <div data-controller="sidebar">
    <%= render "spots/sidebar" %>
  </div>
  <div class="md:flex-1 md:pl-64">
    <div class="flex flex-col items-center justify-center">
      <div class="bg-white rounded-b-lg w-full">
        <div class="mx-auto flex w-full justify-center">
        <div data-controller="search-accordion">
         <div class="mx-auto flex justify-center space-x-2 p-4 md:p-8">
          <button onclick="showCurrentLocation()" class="w-1/2 md:w-1/4 btn inline-block rounded-full py-3 font-sans text-center text-sm font-semibold outline-none transition duration-100 text-secondary hover:bg-primary-hover bg-primary focus-visible:ring sm:w-1/2 md:w-1/2">
            <i class="ph-bold ph-gps fa-lg"></i> 現在地を表示
          </button>
          <button class="w-1/2 md:w-1/4 btn inline-block rounded-full py-3 font-sans text-center text-sm font-semibold outline-none transition duration-100 text-secondary hover:bg-primary-hover bg-primary focus-visible:ring sm:w-1/2 md:w-1/2" 
                  data-action="click->search-accordion#toggle"
                  data-search-accordion-target="toggleButton">
                  <i class="ph-bold ph-list-magnifying-glass fa-lg"></i> 絞り込み
          </button>
          </div>
          <!-- ここから検索アコーディオン -->
          <div class="search-accordion overflow-hidden transition-all duration-500 ease-in-out" 
               data-search-accordion-target="panel">
               <h3 class="text-secondary font-semibold text-center"><i class="ph ph-magnifying-glass fa-lg"></i> 猫スポットを絞り込む</h3>
              <%= render "shared/search", q: @q, url: spots_path %>
            <section class="bg-white rounded-b-lg rounded-lg shadow-lg">
              <div class="container p-6 mx-auto">
                <div class="lg:flex">
                  <div class="w-full lg:w-1/2">
                    <h3 class="text-secondary font-semibold">カテゴリーから検索</h3>
                      <div class="lg:max-w-lg">
                        <div id="category-buttons" class="flex flex-wrap gap-2 p-4">
                          <button id="reset-button" class="bg-primary text-sm text-secondary px-2 py-1.5 rounded-full hover:bg-primary-dark">
                            すべて
                          </button>
                          <% Category.all.each do |category| %>
                            <button data-category-id="<%= category.id %>" class="bg-primary text-sm text-secondary px-2 py-1.5 rounded-full hover:bg-primary-dark">
                              <%= category.name %>
                            </button>
                          <% end %>
                        </div>
                      </div>
                    </div>
      
                    <div class="flex items-center justify-center w-full lg:w-1/2">
                      <div id="region-search" data-controller="accordion" class="w-full py-2 md:py-0 origin-top-right bg-white dark:bg-gray-800 text-secondary">
                        <div class="w-11/12">
                          <h3 class="text-secondary font-semibold">エリア検索</h3>
                        </div>
                        <% Region.all.each do |region| %>
                          <div class="accordion w-full p-2 mt-2 origin-top-right bg-white dark:bg-gray-800 text-secondary">
                            <div class="accordion-header" data-action="click->accordion#toggle">
                              <h3 class="region-title">
                                <i class="toggle-icon ph ph-plus transform transition-transform duration-300" data-accordion-target="icon"></i>&ensp;<%= region.name %>
                              </h3>
                            </div>
                            <div class="accordion-body overflow-hidden transition-all duration-500 ease-in-out max-h-0" data-accordion-target="body">
                              <ul class="prefecture-list flex flex-wrap">
                                <% region.prefectures.each do |prefecture| %>
                                  <li class="w-1/2">
                                    <button id="prefecture-<%= prefecture.id %>" 
                                      name="prefecture-<%= prefecture.id %>" 
                                      class="prefecture-btn w-full flex items-center p-3 text-sm capitalize transition-colors duration-300 transform dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 dark:hover:text-white" 
                                      data-prefecture-id="<%= prefecture.id %>" 
                                      data-lat="<%= prefecture.latitude %>" 
                                      data-lng="<%= prefecture.longitude %>">
                                      <%= prefecture.name %>
                                    </button>
                                  </li>
                                <% end %>
                              </ul>
                            </div>
                          </div>
                        <% end %>
                      </div>
                    </div>
                  </div>
                </div>
                <button class="w-full flex items-center justify-center p-3 capitalize transition-colors duration-300 transform text-secondary hover:bg-gray-100"
                 data-action="click->search-accordion#close"><i class="ph ph-x">
                 </i>&ensp;とじる
                 </button>
              </section>
          </div>
        </div>
        </div>



          <!-- Map表示部分 -->
        <div class="mx-auto flex w-full justify-center">
          <div id="map"
            data-cafe-icon="<%= asset_path('cafe.png') %>"
            data-zoo-icon="<%= asset_path('zoo.png') %>"
            data-island-icon="<%= asset_path('island.png') %>" 
            data-lat="35.6895" data-lng="139.6917" 
            class="w-screen h-screen md:h-96 md:w-11/12 md:rounded-xl"></div>
        </div>
        
        <!-- infoCard -->
      <div class="flex flex-col items-center justify-center md:my-8 md:bottom-0 bottom-20 w-full relative">
        <% @spots.each do |spot| %>
          <%= link_to spot_path(spot), data: { turbo: false }, class: "w-11/12 rounded-xl infoCard-link" do %>
            <div id="infoCard-<%= spot.id %>" class="hidden bg-white border rounded-xl shadow-sm flex mx-auto w-11/12 md:w-full absolute md:relative bottom-0 inset-x-0 z-10 md:mb-50 hover:shadow-lg group">
              <!-- ×ボタン -->
                <button onclick="hideInfoCard(event, <%= spot.id %>)" class="absolute top-1 right-2 text-secondary focus:outline-none z-20 md:hidden">
                  <i class="ph ph-x"></i>
                </button>  
                <div class="flex-shrink-0 relative overflow-hidden h-33 w-32 md:w-1/3 md:rounded-se-none">
                  <img id="spotImage-<%= spot.id %>" class="w-full h-full absolute top-0 rounded-l-xl left-0 object-cover transition-transform duration-200 ease-in-out group-hover:scale-110 group-hover:rounded-l-xl" src="" alt="Image Description">
                </div>
                <div class="flex flex-wrap">
                  <div class="p-4 flex flex-col h-full sm:p-7">
                    <h3 id="spotName-<%= spot.id %>" class="text-lg font-bold text-neutral font-zenmaru overflow-hidden whitespace-nowrap text-overflow-ellipsis"></h3>
                    <div class="justify-start flex md:space-x-4 space-x-2 mt-2">
                      <div class="inline-flex">
                        <p id="spotCategory-<%= spot.id %>" class="text-xs text-white py-1 px-2 rounded-full bg-accent dark:text-neutral-500"></p>
                      </div>
                      <p id="spotRating-<%= spot.id %>" class="text-secondary"></p>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

<%= javascript_include_tag "gmap" %>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GMAP_API_KEY'] %>&callback=initMap" async defer></script>